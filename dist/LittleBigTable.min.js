window.littleBIGtable=function(t){return{settings:{url:null,key_prefix:"lBt",limit:10,multisort:!1,args:{limit:"limit",offset:"offset",search:"search",sort:"sort",columnSearch:"column_search"},messages:{loading:"Loading...",failed:"Loading failed",summary:"rows"},headers:{"Content-Type":"application/json","X-Requested-With":"littleBIGtable"},formatters:{},icons:"../dist/icons.svg"},meta:{loading:!1,status:null},params:{limit:10,offset:0,search:null,total:0},rows:[],sort:{},columnSearch:{},init:function(){for(i in this.params.limit=localStorage.getItem(this.settings.key_prefix+".limit"),(this.params.limit<10||this.params.limit>100)&&(this.params.limit=this.settings.limit),t)this.settings.hasOwnProperty(i)&&(this.settings[i]=t[i]);this.fetch()},fetch:function(t){function s(){return t.apply(this,arguments)}return s.toString=function(){return t.toString()},s}((function(){var t=this;this.settings.url?(this.meta.loading=!0,this.setStatus(this.settings.messages.loading),fetch(this.settings.url+this.getUrlParams(),{headers:this.settings.headers}).then((function(t){return t.json()})).then((function(s){for(i in t.rows=[],t.params.total=s.total,s.data)t.addRow(s.data[i])})).then((function(){t.meta.loading=!1,t.setStatus(t.getSummary(t.settings.messages.summary))})).catch((function(s){console.error("Network fetch failed: ",s),t.setStatus(t.settings.messages.failed)}))):this.setStatus("Missing endpoint url, ensure you specify it in settings.")})),addRow:function(t){var s={};for(i in t)"function"==typeof this.settings.formatters[i]?(fn=this.settings.formatters[i],s[i]=fn(t[i],t)):s[i]=t[i];for(i in this.settings.formatters)s.hasOwnProperty(i)||(fn=this.settings.formatters[i],s[i]=fn(t[i],t));this.rows.push(s)},getUrlParams:function(){var t=(this.settings.url.indexOf("?")>-1?"&":"?")+this.settings.args.limit+"="+this.params.limit+"&"+this.settings.args.offset+"="+this.params.offset;this.params.search&&(t+="&"+this.settings.args.search+"="+this.params.search);var s=null;for(i in this.sort)s=i+":"+this.sort[i];s&&(t+="&"+this.settings.args.sort+"="+s);var e=null;for(var a in this.columnSearch)e=a+":"+this.columnSearch[a],t+="&"+this.settings.args.columnSearch+"[]="+e;return t},getCurrentPage:function(){return 0==this.params.offset?1:parseInt(parseInt(this.params.offset)/parseInt(this.params.limit)+1)},getTotalPages:function(){return parseInt(Math.ceil(parseInt(this.params.total)/parseInt(this.params.limit)))},getTotalRows:function(){return parseInt(this.params.total)},getFirstPageOffset:function(){return 0},getPrevPageOffset:function(){var t=parseInt(parseInt(this.getCurrentPage()-2)*parseInt(this.params.limit));return t<0?0:t},getNextPageOffset:function(){return parseInt(parseInt(this.getCurrentPage())*parseInt(this.params.limit))},getLastPageOffset:function(){var t=parseInt(parseInt(this.getTotalPages()-1)*parseInt(this.params.limit));return t<0?0:t},getOffsetForPage:function(){if(this.params.total<this.params.limit)return 0;for(i=0;i<parseInt(this.params.total);i+=parseInt(this.params.limit))if(i>=this.getPrevPageOffset()&&i<=this.getNextPageOffset())return parseInt(i)+parseInt(this.params.limit);return this.getLastPageOffset()},getFirstDisplayedRow:function(){return this.params.offset+1},getLastDisplayedRow:function(){var t=parseInt(this.params.offset)+parseInt(this.params.limit);return t>this.params.total&&(t=this.params.total),t},getSummary:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rows",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"results";return this.rows.length?"pages"==t.toLowerCase()?"Showing page <strong>"+this.getCurrentPage()+"</strong> of <strong>"+this.getTotalPages()+"</strong>":"Showing <strong>"+this.getFirstDisplayedRow()+"</strong> to <strong>"+this.getLastDisplayedRow()+"</strong> of <strong>"+this.getTotalRows()+"</strong> "+s:"No results"},getSortIcon:function(t){var s="none";return void 0!==this.sort[t]&&(s=this.sort[t]),'<svg class="icon"><use xlink:href="'+this.settings.icons+"#sort-"+s+'"></use></svg>'},setLimit:function(){(this.params.limit<10||this.params.limit>100)&&(this.params.limit=10),this.params.offset=this.getOffsetForPage(),localStorage.setItem(this.settings.key_prefix+".limit",this.params.limit),this.fetch()},setStatus:function(t){this.meta.status=t},toggleSortColumn:function(t){null==this.sort[t]?this.sort[t]="asc":"asc"==this.sort[t]?this.sort[t]="dsc":"dsc"==this.sort[t]&&delete this.sort[t]},goFirstPage:function(){this.params.offset=this.getFirstPageOffset(),this.fetch()},goLastPage:function(){this.params.offset=this.getLastPageOffset(),this.fetch()},goNextPage:function(){this.params.offset=this.getNextPageOffset(),this.fetch()},goPrevPage:function(){this.params.offset=this.getPrevPageOffset(),this.fetch()},goToPage:function(){},doSearch:function(){this.params.offset=0,this.fetch()},doColumnSearch:function(t){this.columnSearch[t.name]=t.value,this.fetch()},doSort:function(t){if(0==this.settings.multisort){var s=this.sort[t];this.sort={},this.sort[t]=s}this.toggleSortColumn(t),this.fetch()},debug:function(){return"Params:\n"+JSON.stringify(this.params)+"\nSort:\n"+JSON.stringify(this.sort)+"\nMeta:\n"+JSON.stringify(this.meta)+"\nSettings:\n"+JSON.stringify(this.settings)}}};